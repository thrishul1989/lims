<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<title>报告二审</title>
<link href="${system_css}/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
<link href="${system_css}/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">
<link href="${system_css}/animate.min.css" rel="stylesheet">
<link href="${system_css}/style.min862f.css?v=4.1.0" rel="stylesheet">
<link href="${plugins}/jstree/themes/default/style.min.css" rel="stylesheet">
<link href="${system_css}/lims.css?v=4.1.0" rel="stylesheet">
</head>
<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox">
                    <div class="ibox-title">
                        <ol class="breadcrumb">
                            <li>
                                <a href="#">报告审核</a>
                            </li>
                            <li class="active">
                                <strong>报告二审</strong>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="ibox ibox-table">
                    <div class="ibox-title">
                        <h5>报告二审</h5>
						<@smm_security_resource resource = "/bpm/report/secondReview/batchDownload.do">
                        <a href="#" id="btn_download" class="btn btn-sm btn-success">
                            <i class="fa fa-download"></i> 批量导出
                        </a>
						</@smm_security_resource>
                    </div>
                    <div class="ibox-content" style="overflow: hidden; zoom: 1">
                        <div class="col-sm-12">
                            <form action="${base}/bpm/report/secondReview/list.do" method="post" class="search-form form-inline" id="search_from" >
                                <div class="col-sm-4">
                            		<div class="form-group">
                                		<label class="control-label">报告编号：</label>
                                		<input type="text" class="form-control" name="reportCode" value="${(searcher.reportCode)!?html}">
                             		</div>
								</div>
								<div class="col-sm-4">
	                            	<div class="form-group">
		                                <label class="control-label">样本编号：</label>
		                                <input type="text" class="form-control" name="sampleCode" value="${(searcher.sampleCode)!?html}">
	                            	</div>
								</div>
								<div class="col-sm-4">
	                            	<div class="form-group">
		                                <label class="control-label">产品名称：</label>
		                                <input type="text" class="form-control" name="productName" value="${(searcher.productName)!?html}">
	                            	</div>
								</div>
								<div class="col-sm-4">
	                            	<div class="form-group">
		                                <label class="control-label">技术负责人：</label>
		                                <input type="text" class="form-control" name="technicalMan" value="${(searcher.technicalMan)!?html}">
	                            	</div>
								</div>
								<div class="col-sm-4">
	                              	<div class="form-group">
										<label class="control-label">营销中心：</label>
										<select class="form-control" id="marketingCenter" name="marketingCenter" data-value="${searcher.marketingCenter!?html}">
											<option value="">--所有类型--</option>
											<#if testingTypeList??> 
												<#list testingTypeList as entry>
												<option  value="${entry.id!?html}">${entry.name!?html}</option>
											</#list>
											</#if>
										</select>
									</div>
								</div>
								<div class="col-sm-4">
	                              	<div class="form-group">
										<label class="control-label">是否参与：</label>
										<select class="form-control" id="analType" name="analType" data-value="${searcher.analType!?html}">
											<option value="">--所有类型--</option>
											<@dict_entries category="ANALYSIS_TYPE">
	                                        <#list entries as entry>
	                                        <option value="${entry.value!}">${entry.text!?html}</option>
	                                        </#list>
	                                        </@dict_entries>
										</select>
									</div>
								</div>
								<div class="col-sm-4">
	                            	<div class="form-group">
		                                <label class="control-label">报告审核员：</label>
		                                <input type="text" class="form-control" name="reviewerName" value="${(searcher.reviewerName)!?html}">
	                            	</div>
								</div>
								<div class="col-sm-4">
	                            	<div class="form-group">
		                                <label class="control-label">订单编号：</label>
		                                <input type="text" class="form-control" name="orderCode" value="${(searcher.orderCode)!?html}">
	                            	</div>
								</div>
								<div class="col-sm-4">
	                               <div class="form-group">
	                                   <label class="control-label">出报告日期起：</label>
									   <input type="text" id="reportDateStart" class="form-control laydate-icon" name="reportDateStart" 
									   readOnly="readOnly" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})" value="${(searcher.reportDateStart)!?html}"/>
								   </div>
	                            </div>
							    <div class="col-sm-4">
	                               <div class="form-group">
	                                   <label class="control-label">出报告日期止：</label>
									   <input type="text" id="reportDateEnd" class="form-control laydate-icon" name="reportDateEnd" 
									   readOnly="readOnly" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})" value="${(searcher.reportDateEnd)!?html}"/>
								   </div>
		                        </div>
		                        <div class="col-sm-4">
	                            	<div class="form-group">
		                                <label class="control-label">受检人：</label>
		                                <input type="text" class="form-control" name="inspectMan" value="${(searcher.inspectMan)!?html}">
	                            	</div>
								</div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <button type="submit" class="btn btn-sm btn-success">
                                            <i class="fa fa-search"></i> 查询
                                        </button>
                                        <button type="button" class="btn btn-sm btn-success" onclick="clearCondition('search_from')" >
											<i class="fa fa-remove"></i> 清空
										</button>
                                    </div>
                                </div>
                            </form>
                            <div class="ibox-content" style="overflow: auto">
	                            <table class="table table-striped table-bordered table-hover" style="min-width: 130%">
	                                <thead>
	                                    <tr>
	                                        <th class="index"><input type="checkbox" class="check-controller" /></th>
	                                        <th>报告编号</th>
	                                        <th>报告名称</th>
	                                        <th>订单编号</th>
	                                        <th>受检人</th>
	                                        <th>样本编号</th>
	                                        <th>检测产品</th>
	                                        <th>技术负责人</th>
	                                        <th>报告审核员</th>
	                                        <th>应出报告日期</th>
	                                        <th>出报告日期</th>
	                                        <th>是否重出</th>
	                                    	<th>审核意见</th>
	                                    	<th>是否加急</th>
	                                        <th class="flexible-btns">操作</th>
	                                    </tr>
	                                </thead>
	                                <tbody>
	                                    <#if pagination??><#if pagination.records?has_content> <#list pagination.records as record>
	                                    <tr>
	                                        <td><input type="checkbox" class="check-instance" value="${(record.combineFileName)!?html}" /> &nbsp;${record_index + 1}</td>
	                                        <td>${(record.reportCode)!?html}</td>
	                                        <td>${(record.reportName)?substring(20)!?html}</td>
	                                        <td>${(record.orderCode)!?html}</td>
	                                        <td>${(record.sampleName)!?html}</td>
	                                        <td>${(record.sampleCode)!?html}</td>
	                                        <td>${(record.productName)!?html}</td>
	                                        <td>${(record.technicalMan)!?html}</td>
	                                        <td>${(record.reviewerName)!?html}</td>
	                                        <td><#if record.shouldReportDate??>${(record.shouldReportDate)!?string('yyyy-MM-dd')}</#if></td>
	                                        <td><#if record.reportDate??>${(record.reportDate)!?string('yyyy-MM-dd')}</#if></td>
											<td>
												<#if record.resubmit??>
													<#if record.resubmit>
														<span style="color: red">重出（${(record.resubmitCount)!0}次）</span>
													<#else>
														<span style="color: green">正常</span>
													</#if>
												</#if>
											</td>
		                                    <td title="${(record.remark)!?html}"><#if (record.remark)?? && record.remark?length gt 16>${(record.remark)[0..15]}...<#else>${(record.remark)!?html}</#if></td>
	                                       	<td>
	                                        	<#if record.order??>
	                                        		<#if record.order.ifUrgent??>
			                                    		<#if record.order.ifUrgent == 1>是</#if>
		                                    		</#if>
	                                        	</#if>
	                                        </td>
	                                        <td class="flexible-btns btn_td">
	                                        	<input type="hidden" class="recordId" value="${record.id!?html}"/>
	                                        	<#if record.pdfFile>
												<@smm_security_resource resource = "/bpm/report/secondReview/wordToHtml.do">
	                                        	<a href="<@download_url fileName=record.dataUrl/>" target="_black" class="btn btn-sm btn-success">
	                                                <i class="fa fa-search-plus"></i> 预览
	                                            </a>
												</@smm_security_resource>
	                                            </#if>
	                                            <#if record.docxFile>
												<@smm_security_resource resource = "/bpm/report/secondReview/wordToHtml.do">
	                                        		<a href="${base}/bpm/report/secondReview/wordToHtml.do?fileName=${(record.dataUrl)!?html}" target="_black" class="btn btn-sm btn-success">
	                                                <i class="fa fa-search-plus"></i> 预览
	                                            </a>
												</@smm_security_resource>
	                                            </#if>
	                                            <@smm_security_resource resource = "/bpm/report/secondReview/download.do">
	                                            <a onclick="exportData('${(record.combineFileName)!?html}')" class="btn btn-sm btn-success">
	                                                <i class="fa fa-download"></i> 导出
	                                            </a>
	                                            </@smm_security_resource>
	                                            <@smm_security_resource resource = "/bpm/report/secondReview/review.do">
	                                            <a href="#" id="btn_review" class="btn btn-sm btn-success">
	                                                <i class="fa fa-edit"></i> 审核
	                                            </a>
	                                            </@smm_security_resource>
											<@smm_security_resource resource = "/bpm/report/secondReview/handleView.do">
	                                            <a href="${base}/bpm/report/secondReview/handleView.do?id=${record.id}&viewStatus=2" class="btn btn-sm btn-success">
	                                                <i class="fa fa-search-plus"></i>查看数据
	                                            </a>
											</@smm_security_resource>
	                                        </td>
	                                    </tr>
	                                    </#list> <#else>
	                                    <tr>
	                                        <td colspan="10">暂无相关记录</td>
	                                    </tr>
	                                    </#if> </#if>
	                                </tbody>
	                            </table>
                            </div>
                            <#include "../../inc/pagination.html" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="review_dialog" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content animated bounceInRight">
                <div class="modal-content" style="height: 600px">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">
                            <span aria-hidden="true">&times;</span>
                            <span class="sr-only">关闭</span>
                        </button>
                        <h4 class="modal-title">报告二审</h4>
                    </div>
                    <div class="modal-body">
                        <iframe id="dialog_content" name="review_frame" src="" target="self" style="border: 0; width: 850px; height: 420px;"> </iframe>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="released">提交</button>
                        <button type="button" class="btn btn-white" data-dismiss="modal">取消</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <form action="${base}/bpm/report/secondReview/batchDownload.do" method="post" id="downloadForm">
            <input type="hidden" id="keys" name="keys">
        </form>
    </div>
</body>
<script type="text/javascript" src="${system_js}/jquery.min.js?v=2.1.4"></script>
<script type="text/javascript" src="${plugins}/jstree/jstree.min.js"></script>
<script type="text/javascript" src="${system_js}/bootstrap.min.js"></script>
<script src="${system_js}/bootstrap-suggest.js"></script>
<script type="text/javascript" src="${system_js}/system.js"></script>
<script type="text/javascript" src="${system_js}/metadata.tree.js"></script>
<script src="${plugins}/pagination/jquery.pagination.js"></script>
<script type="text/javascript" src="${plugins}/laydate/laydate.js"></script>
<script type="text/javascript" src="${system_js}/report/reportSecondReview.js"></script>
<script type="text/javascript">
function exportData(combineFileName)
{
	  $.ajax({
	        type : "GET",
	        url : "${base}/bpm/report/firstReview/isCandownload.do?fileName="+combineFileName,
	        success : function(data)
	        {
	        	if(null != data && 1 == data)
	        	{
	        		parent.parent.layer.alert('文件不存在或请求url失败！', {title : "提示"});
	        	}
	        	else
	        	{
	        		window.location.href="${base}/bpm/report/secondReview/download.do?fileName="+combineFileName;
	        	}
	        },
	        error : function()
	        {
	            alert("failed");
	        }
	    });
}
</script>
</html>
